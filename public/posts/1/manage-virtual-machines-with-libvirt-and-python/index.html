<!doctype html><html lang=en><head><title>Manage libvirt with Python :: fooock blog — Random things about blockchain, scraping and virtualization</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=description content="If you don&amp;rsquo;t know what the libvirt is, then the official web page can clarify some things:
 The libvirt project is a toolkit to manage virtualization platforms. It is used by many applications and support multiple hypervisors like KVM, QEMU, Xen, VMWare and others.
 In this post I will show you how to interact with libvirt using Python and the KVM hypervisor, but first things first.
What do you need to start?"><meta name=keywords content="blockchain virtualization scraping ethereum bitcoin solidity kvm qemu"><meta name=robots content=noodp><link rel=canonical href=https://blog.fooock.com/posts/1/manage-virtual-machines-with-libvirt-and-python/><link rel=stylesheet href=https://blog.fooock.com/assets/style.css><link rel=stylesheet href=https://blog.fooock.com/assets/green.css><link rel=apple-touch-icon-precomposed sizes=144x144 href=https://blog.fooock.com/img/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=https://blog.fooock.com/img/favicon/green.png><meta name=twitter:card content=summary><meta name=twitter:title content="Manage libvirt with Python :: fooock blog — Random things about blockchain, scraping and virtualization"><meta name=twitter:description content="If you don&amp;rsquo;t know what the libvirt is, then the official web page can clarify some things:
 The libvirt project is a toolkit to manage virtualization platforms. It is used by many applications and support multiple hypervisors like KVM, QEMU, Xen, VMWare and others.
 In this post I will show you how to interact with libvirt using Python and the KVM hypervisor, but first things first.
What do you need to start?"><meta name=twitter:site content=https://blog.fooock.com><meta name=twitter:creator content=Javi><meta name=twitter:image content><meta property=og:locale content=en><meta property=og:type content=article><meta property=og:title content="Manage libvirt with Python :: fooock blog — Random things about blockchain, scraping and virtualization"><meta property=og:description content="If you don&amp;rsquo;t know what the libvirt is, then the official web page can clarify some things:
 The libvirt project is a toolkit to manage virtualization platforms. It is used by many applications and support multiple hypervisors like KVM, QEMU, Xen, VMWare and others.
 In this post I will show you how to interact with libvirt using Python and the KVM hypervisor, but first things first.
What do you need to start?"><meta property=og:url content=https://blog.fooock.com/posts/1/manage-virtual-machines-with-libvirt-and-python/><meta property=og:site_name content="Manage libvirt with Python"><meta property=og:image content><meta property=og:image:width content=2048><meta property=og:image:height content=1024><meta property=article:published_time content="2019-10-16 19:46:11 &#43;0200 CEST"></head><body><div class="container center"><header class=header><div class=header__inner><div class=header__logo><a href=/><div class=logo>fooock blog</div></a></div><div class=menu-trigger>menu</div></div><nav class=menu><ul class="menu__inner menu__inner--desktop"><li><a href=https://fooock.com>about</a></li><li><a href=https://github.com/fooock/my-blog/issues>report an issue</a></li></ul><ul class="menu__inner menu__inner--mobile"><li><a href=https://fooock.com>about</a></li><li><a href=https://github.com/fooock/my-blog/issues>report an issue</a></li></ul></nav></header><div class=content><div class=post><h1 class=post-title><a href=https://blog.fooock.com/posts/1/manage-virtual-machines-with-libvirt-and-python/>Manage libvirt with Python</a></h1><div class=post-meta><span class=post-date>2019-10-16</span>
<span class=post-author>::
Javi</span></div><span class=post-tags>#<a href=https://blog.fooock.com/tags/libvirt/>libvirt</a>&nbsp;
#<a href=https://blog.fooock.com/tags/python/>python</a>&nbsp;
#<a href=https://blog.fooock.com/tags/kvm/>kvm</a>&nbsp;
#<a href=https://blog.fooock.com/tags/virtualization/>virtualization</a>&nbsp;</span><div class=post-content><p>If you don&rsquo;t know what the <code>libvirt</code> is, then the <a href=https://libvirt.org/>official</a> web page can clarify some things:</p><blockquote><p>The libvirt project is a toolkit to manage virtualization platforms. It is used by many applications and support multiple hypervisors like <code>KVM</code>, <code>QEMU</code>, <code>Xen</code>, <code>VMWare</code> and <a href=https://libvirt.org/drivers.html>others</a>.</p></blockquote><p>In this post I will show you how to interact with libvirt using Python and the <code>KVM</code> hypervisor, but first things first.</p><h3 id=what-do-you-need-to-start>What do you need to start?</h3><p>If you are in Ubuntu like me, you need to install the <code>libvirt-dev</code> package. Using apt is easy:</p><pre><code>$ sudo apt-get install libvirt-dev
</code></pre><p>Also, you will need <a href=https://www.python.org/>Python</a> and <a href=https://pypi.org/project/pip/>pip</a> installed in your system. We will create a new virtual environment using <code>Python 3.7</code>. For this purpuse I use <a href=https://docs.conda.io/en/latest/>Conda</a>. The next command creates a virtual environment called <code>libvirt</code></p><pre><code>$ conda create --name libvirt python=3.7
$ conda install --name libvirt pip
</code></pre><p>When done, you need to activate this environment using <code>conda activate libvirt</code>. Now, we will proceed to install the <a href=https://pypi.org/project/libvirt-python/>libvirt-python</a> package, version <code>5.7.0</code> using pip (at this time, this is the latest release).</p><pre><code>(libvirt) $ pip install libvirt-python==5.7.0
</code></pre><p>If all is ok, then you are ready to go.</p><h3 id=connect-to-the-kvm-hypervisor-driver>Connect to the KVM hypervisor driver</h3><p>As I commented previously, we&rsquo;ll use the <code>KVM</code> hypervisor. As this hypervisor is <code>QEMU</code> compatible, the driver will be <code>qemu:///system</code>. If you want to see other options, see <a href=https://libvirt.org/docs/libvirt-appdev-guide-python/en-US/html/libvirt_application_development_guide_using_python-Connections-URI_Formats.html>this</a>.</p><blockquote><p>Note that this is a privileged URI.</p></blockquote><p>To open a connection to the RPC server exposed by the <em>libvirt daemon</em>, it must be running. You can check it&rsquo;s state using <code>systemctl status libvirtd</code>. In case that the daemon is not available, you will start it using <code>systemctl start libvirtd</code>.</p><blockquote><p>For default, this daemon will only be listening for connection on a local UNIX domain socket. As it is only accessible on the local machine, it&rsquo;s <strong>unencrypted</strong>.</p></blockquote><p>There are two types of sockets:</p><ul><li>Full management capabilities, <code>/var/run/libvirt/libvirt-sock</code>.</li><li>Read only operations, <code>/var/run/libvirt/libvirt-sock-ro</code>.</li></ul><p>We will open the full read-write socket.</p><pre><code>&gt;&gt;&gt; import libvirt
&gt;&gt;&gt; conn = libvirt.open('qemu:///system')
&gt;&gt;&gt; conn.getVersion()
3001000
</code></pre><p>If you want to use the read only socket, then you need to specify it when <code>open()</code> method is called:</p><pre><code>&gt;&gt;&gt; conn = libvirt.open('qemu:///system?socket=/var/run/libvirt/libvirt-sock-ro')
&gt;&gt;&gt; conn.getVersion()
3001000
</code></pre><p>When no hostname is provided in the URI, by default it uses <code>unix</code> transport (same reduntant URI is <code>qemu+unix:///system?socket=...</code>).</p><p>The <code>conn</code> object is of type <code>libvirt.virConnect</code>. All connections should be closed using the <code>close()</code> method:</p><pre><code>&gt;&gt;&gt; conn.close()
0
&gt;&gt;&gt; conn.getVersion()
libvirt: Domain Config error : invalid connection pointer in virConnectGetVersion
Traceback (most recent call last):
  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;
  File &quot;/home/javi/miniconda3/envs/libvirt/lib/python3.7/site-packages/libvirt.py&quot;, line 4016, in getVersion
    if ret == -1: raise libvirtError ('virConnectGetVersion() failed', conn=self)
libvirt.libvirtError: invalid connection pointer in virConnectGetVersion
</code></pre><p>As you can see, after closing the connection, no method calls are allowed.</p><p>Using this connection object you can define new virtual machines, list host domains, filter by name etc, but I will explain it in a new blog posts.</p></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button next"><a href=https://blog.fooock.com/posts/hello-world/><span class=button__text>Hello world!</span>
<span class=button__icon>→</span></a></span></div></div></div></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2019 Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span></div></div></footer><script src=https://blog.fooock.com/assets/main.js></script><script src=https://blog.fooock.com/assets/prism.js></script></div></body></html>